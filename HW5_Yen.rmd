---
title: 'Advanced Data Analyis -HW5: Data Visualization '
author: "Bing-Jie Yen <bj.yen@wustl.edu>"
date: "Feb 15th, 2018"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
---


Complete the below data visualization tasks in R Markdown and submit the Notebook HTML file on Blackboard. Don't forget to use promising practices in your coding. This homework continues to use the BRFSS.48K.csv that we used in class.

# Read in data and load libraries
Read in BRFSS data and get rid of all rows which have any missing values (NA). 
```{r,results="hide"}
library(ggplot2)
library(plyr)

BRFSS<-'https://raw.githubusercontent.com/kijohnson/Advanced-Data-Analysis/master/Class%204%20Data%20Visualization/dat/BRFSS.48K.csv'
BRFSS<-read.csv(BRFSS)
BRFSS<-as.data.frame(BRFSS)
BRFSS <- BRFSS[rowSums(is.na(BRFSS))==0,]
```
# Bar plot with calculated order and basic plot of counts

Create a bar plot of counts of income column. Order the columns by descending order, so that the most
counts (tallest bar) is on the left.
```{r}
# recognize the counts in each income category
count(BRFSS$income)  
# Order data by  counts (lengths) of each income category 
BRFSS$income <- with(BRFSS, reorder(income, income, function(x) -length(x)))

ggplot(BRFSS, aes(income))+ geom_bar(fill="steelblue")+theme(axis.text.x = element_text(angle = 15, vjust = 0.5, hjust=1))

```

Suppose we want to calculate the total weight of all individuals per state. We can add up all weights for each state with the following,


```{r}
#Note that this step could only be done if row sum of BRFSS is not equal to 0. 
state.weight <- ddply(BRFSS, "state", summarise, tot.weight=sum(weight)) 
head(state.weight)
```

Create a bar plot with the total weight for each state indicated by bar height. Label your Y variable with
units.

```{r}
ggplot(data=state.weight, aes(state, tot.weight)) + geom_bar(stat = "identity",fill="steelblue")+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))


```

# Scatter plot with age

Create a scatter plot of height and weight, with age indicated for each point by some other aesthetic. Try using aesthetics such as color,fill, size, shape, and alpha (opacity) to emphasize features which may be interesting. Label your X and Y variables with units.

```{r}
# Categorize continous variable "age" and generate a new categorical variable "age_cat" which include 6 age groups
BRFSS$age_cat<-ifelse(BRFSS$age>=18 &BRFSS$age<30, "Age between 18 and 29",
                      ifelse(BRFSS$age>=30 &BRFSS$age<40, "Age between 30 and 39",
                            ifelse(BRFSS$age>=40 &BRFSS$age<50, "Age between 40 and 49",
                                    ifelse(BRFSS$age>=50 &BRFSS$age<60, "Age between 50 and 59",
                ifelse(BRFSS$age>=60 &BRFSS$age<70, "Age between 60 and 69","70 years old and up")))))
# Order age levels
age.levels=c(
  "Age between 18 and 29",
  "Age between 30 and 39",
  "Age between 40 and 49",
  "Age between 50 and 59",
  "Age between 60 and 69",
  "70 years old and up")

BRFSS$age_cat <- factor(BRFSS$age_cat, levels = age.levels)

p <- ggplot (data=BRFSS)

library (RColorBrewer)
p <- p + geom_point ( aes (x=height, y=weight, color=age_cat))+ 
    scale_color_brewer(palette="Set1",name="Age category")+ xlab ("Height [m]") + ylab ("Weight [kg]")
p
```


# Compare sexes

Create a scatter plot of height and weight that illustrates the distibution of the two sexes. Label your X and Y variables with units.

```{r}
library (RColorBrewer)
p <- ggplot (data=BRFSS)
p <- p + geom_point ( aes (x=height, y=weight, color=sex),size=1)+
    scale_color_brewer(palette="Set1",name="Sex")+ xlab ("Height [m]") + ylab ("Weight [kg]")+facet_wrap(~sex)
p
```

#  Bubble plots
Create a bubble plot, which displays counts of observations two categorical variables as the size of a geom_point. We can obtain counts of income and employed status, for instance, with the below code.

```{r}
income.employed.count = count(BRFSS, c("employed", "income"))
head(income.employed.count)
# Draw a bubble plot
p <- ggplot(data=income.employed.count)
p <- p + geom_point(aes(x=employed, y=income,size=freq))+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
p

```


#Superpose boxplots over violin plots
## Draw box plots (geom_boxplot) instead of violins for weight and diabetes
```{r}
p <- ggplot(data=BRFSS)
#color=NA means transparent
p <- p + geom_boxplot(aes(x=diabetes_short_label, y=weight, fill=diabetes_short_label), color=NA) + guides(fill=FALSE)

p <- p + scale_fill_brewer(palette="Set1", name="Diabetes Status")
p <- p + theme_bw() + xlab("Diabetes Status") + ylab("Weight [kg]")+ylim (25, 250)
p <- p + theme(panel.grid.major.x = element_blank())+xlab("Diabetes Status")+ylab("Wight [kg]")
p


```
## Superimpose the boxplots over the top of the violin plots. Label your X and Y variables with units.

```{r}
p <- ggplot(data=BRFSS)
p <- p + geom_violin(aes(x=diabetes_short_label, y=weight, fill=diabetes_short_label), color=NA) + guides(fill=FALSE)

p <- p + geom_boxplot(aes(x=diabetes_short_label, y=weight,fill=diabetes_short_label), alpha=0.5) + guides(fill=FALSE)

p <- p + scale_fill_brewer(palette="Set1") + scale_color_brewer(palette="Set1", name="Diabetes Status") 
p <- p + theme_bw() + xlab("Diabetes Status") + ylab("Weight [kg]")
p <- p + theme(panel.grid.major.x = element_blank())
p
```

# Indicate significant  differences (Bonus problem 0.1 extra points)
Evaluate whether the weight distribution between any two pairs of diabetes status categories on the violin plots is signficantly dfferent. Devise a way to indicate which pairs of distributions are signficantly dfferent.
This is still hard to see because of overlapping points.  Reduce opacity (alpha) to make points more transparent
```{r}
p <- ggplot(data=BRFSS)
p <- p + geom_violin(aes(x=diabetes_short_label, y=weight, fill=diabetes_short_label), color=NA) + guides(fill=FALSE)

# Limit y range so the median bar is more significant in the graph
p <- p + geom_boxplot(aes(x=diabetes_short_label, y=weight,fill=diabetes_short_label), alpha=0.3) + guides(fill=FALSE)+ylim(25,150)

p <- p + scale_fill_brewer(palette="Set1") + scale_color_brewer(palette="Set1", name="Diabetes Status") 
p <- p + theme_bw() + xlab("Diabetes Status") + ylab("Weight [kg]")
p <- p + theme(panel.grid.major.x = element_blank())
p
```



# References
http://www.cookbook-r.com/Graphs/
